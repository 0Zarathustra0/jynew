# 理解DOS版《金群》的运行流程

![图片1](https://user-images.githubusercontent.com/7448857/119352524-5def8900-bcd4-11eb-8d6b-eead9701436f.png)


进入一个场景后，玩家可以在可通行区域进行移动。
在预设好的位置有触发器（上图数字所示），在触发器位置进行对应的交互（按空格、使用物品、或者移动至）即可触发对应的脚本交互。

脚本由许多指令组成，指令包括如显示对话、获得物品、战斗、增减道德、或者修改本地图/其他地图的指定触发器（非常重要）、修改本地图/其他地图可显示元素。

玩家不断进入各个场景，与触发器进行交互，从而推进游戏。

具体的游戏逻辑你可以参考这个开源项目辅助理解：https://github.com/scarsty/kys-cpp


# 重置版《金群3D版》

与DOS版游戏完全一致，所有的脚本均沿用DOS版设定。
不同的是DOS版游戏触发器是绑定在格子上的，而重置版游戏的触发器是一个3D区域。
判断玩家是否在触发器内，不是基于玩家坐标，而是基于玩家的碰撞体和触发器的碰撞体是否相交。

![图片2](https://user-images.githubusercontent.com/7448857/119352672-8d9e9100-bcd4-11eb-8986-4265b98bf501.png)

# 使用DOS版的MOD编辑器了解游戏流程

在[tools](https://github.com/jynew/jynew/tree/main/tools)目录里，解压以下压缩包：

* kys-c++.zip
* upedit4kyscpp.zip

可以使用upedit4kyscpp这个第三方MOD工具，将工作目录配置在kys-c++下即可，这样可以完成原版的资源映射。

## 事件映射
打开“我要改场景”，可以看到原版游戏中场景和事件的映射关系。

![图片3](https://user-images.githubusercontent.com/7448857/119353074-069de880-bcd5-11eb-9306-f461c439742c.png)

具体的参数如下

![图片4](https://user-images.githubusercontent.com/7448857/119353077-07cf1580-bcd5-11eb-8417-8112d465bb1e.png)

这里需要重点关注的是 事件1-3，分别为使用空格触发、使用道具触发、进入区域触发。
在这里，灵蛇岛中金花婆婆（0号触发器）对应的是空格触发98号事件

## 贴图关系

在MOD编辑器里，所有贴图对应的是kys-c++\game\resource\smap里内容，但编号都需要除以2
举例说明，田伯光居0号触发器上有标记动画

![图片5](https://user-images.githubusercontent.com/7448857/119353235-39e07780-bcd5-11eb-9b24-d0a17ca862c3.png)

其对应的文件为5912/2 = 2956到5924/2=2962，可以在smap目录里看到

![图片6](https://user-images.githubusercontent.com/7448857/119353253-3fd65880-bcd5-11eb-8fa0-98e135b0a7aa.png)
